<html>

<!-- these 4 files always have to be included -->
<link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css"/>
<script type="text/javascript" src="../../lib/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="../../socket.io/socket.io.js"></script>
<script type="text/javascript" src="../../lib/js/jquery-ui-1.10.3.full.min.js"></script>

<!-- these two file always have to be included -->
<link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>
<script type="text/javascript" src="../../js/translate.js"></script>
<script type="text/javascript" src="../../js/adapter-settings.js"></script>

<!-- you have to define 2 functions in the global scope: -->
<script type="text/javascript">
    var rooms =       [];
    var roomsSelect = "";
    var devices =     [];
    var processed =   1000;
    var isStarted =   null;

    systemDictionary = {
        "Pushsafer adapter settings":      {"de": "Pushsafer-Adapter Einstellungen",  "ru": "Настройки Pushsafer драйвера"},
        "Pushsafer settings":              {"de": "Pushsafer Einstellungen:",         "ru": "Настройки Pushsafer сервера"},
        "Device:":                         {"de": "Gerät:",                           "ru": "Yстройство:"},
        "Private Key:":                    {"de": "Privater Schlüssel:",              "ru": "Закрытый ключ:"},
        "Title:":                          {"de": "Titel:",                           "ru": "Заголовок:"},
        "Sound:":                          {"de": "Klang:",                           "ru": "Звук:"},
	"Icon:":                           {"de": "Icon:",                            "ru": "Икона:"},
	"Icon number 1-98:":               {"de": "Icon Nummer 1-98:",                "ru": "Иконка номер 1-98"},
	"Vibration:":                      {"de": "Vibration:",                       "ru": "Вибрация:"},
	"Vibration number 0-3:":           {"de": "Vibration Nummer 0-3:",            "ru": "Вибрация номер 0-3"},
        "Test":                            {"de": "Test",                             "ru": "Тест"},
        "Notification settings":           {"de": "Mitteilung Einstellungen",         "ru": "Настройки сообщения"},
        "Device ID or Device Group ID":    {"de": "Geräte ID oder Geräte Gruppen ID", "ru": "Идентификатор устройства или Группа идентификатор устройства"},
        "Private or Alias Key from your Pushsafer.com account": {"de": "Privater oder Alias Schlüssel von deinem Pushsafer.com Konto",   "ru": "Частный или псевдоним ключа из вашего аккаунта Pushsafer.com"}
    };

    // the function loadSettings has to exist ...
    function load(settings, onChange) {
        for (var key in settings) {
            if ($('#' + key + '.value').attr('type') == 'checkbox') {
                $('#' + key + '.value').prop('checked', settings[key]).change(function() {
                    onChange();
                });
            } else {
                $('#' + key + '.value').val(settings[key]).change(function() {
                    changed = true;
                    $('#save').button("enable");
                }).keyup(function() {
                    onChange();
                });
            }
        }
        onChange(false);
        $('#test').button().click(test);
    }

    function test() {
        //var newValue = JSON.stringify(getSettings());
        if (!common.enabled) {
            showMessage('Enable first the adapter to test notification.');
            return;
        }
        if (changed) {
            showMessage('First save the settings');
            return;
        }
        sendTo('pushsafer.' + instance, 'send', 'This is test notification!');
        showMessage('Check the log or your pushsafer app!');
    }

    function saveHelper(obj, id, value) {
        var ids = id.split('_');
        if (ids.length === 1) {
            obj[id] = value;
        } else if (ids.length === 2) {
            if (!obj[ids[0]]) obj[ids[0]] = {};
            obj[ids[0]][ids[1]] = value;
        } else if (ids.length === 3) {
            if (ids[2] == "pass") {
                value = encrypt("Zgfr56gFe87jJOM", value);
            }

            if (!obj[ids[0]]) obj[ids[0]] = {};
            if (!obj[ids[0]][ids[1]]) obj[ids[0]][ids[1]] = {};
            obj[ids[0]][ids[1]][ids[2]] = value;
        }
        return obj;
    }

    function getSettings() {
        var obj = {};
        $('.value').each(function () {
            var $this = $(this);
            var id = $this.attr('id');

            if ($this.attr('type') == 'checkbox') {
                obj = saveHelper(obj, id, $this.prop('checked'))
            } else {
                obj = saveHelper(obj, id, $this.val())
            }
        });
        return obj;
    }

    function save(callback) {
        callback(getSettings());
    }
</script>

<!-- you have to put your config page in a div with id adapter-container -->
<div id="adapter-container">

    <table><tr>
        <td><img src="pushsafer.png"></td>
        <td style="padding-top: 20px;padding-left: 10px"><h3 class="translate">Pushsafer adapter settings</h3></td>
    </tr></table>

    <h4 class="translate">Pushsafer settings</h4>
    <table>
        <tr>
            <td class="translate">Private Key:</td>
            <td><input id="token" type="text" size="50" class="value"/></td>
            <td class="translate">Private or Alias Key from your Pushsafer.com account</td>
        </tr>
        <tr><td colspan="3"><br><h4 class="translate">Notification settings</h4></td></tr>
        <tr>
            <td class="translate">Title:</td>
            <td><input id="title" type="text" size="50" class="value"/></td>
            <td></td>
        </tr>
        <tr>
            <td class="translate">Device:</td>
            <td><input id="device" type="text" size="50" class="value"/></td>
            <td class="translate">Device ID or Device Group ID</td>
        </tr>
        <tr>
            <td class="translate">Icon:</td>
            <td><input id="icon" type="text" size="50" class="value"/></td>
            <td class="translate">Icon number 1-98</td>
        </tr>
        <tr>
            <td class="translate">Vibration:</td>
            <td><input id="vibration" type="text" size="50" class="value"/></td>
            <td class="translate">Vibration number 0-3</td>
        </tr>
        <tr>
            <td class="translate">Sound:</td>
            <td><select id="sound" class="value">
					<option value="">Device Default</option>
					<option value="0">OFF</option>
					<option value="1">Ahem (IM)</option>
					<option value="2">Applause (Mail)</option>
					<option value="3">Arrow (Reminder)</option>
					<option value="4">Baby (SMS)</option>
					<option value="5">Bell (Alarm)</option>
					<option value="6">Bicycle (Alarm2)</option>
					<option value="7">Boing (Alarm3)</option>
					<option value="8">Buzzer (Alarm4)</option>
					<option value="9">Camera (Alarm5)</option>
					<option value="10">Car Horn (Alarm6)</option>
					<option value="11">Cash Register (Alarm7)</option>
					<option value="12">Chime (Alarm8)</option>
					<option value="13">Creaky Door (Alarm9)</option>
					<option value="14">Cuckoo Clock (Alarm10)</option>
					<option value="15">Disconnect (Call)</option>
					<option value="16">Dog (Call2)</option>
					<option value="17">Doorbell (Call3)</option>
					<option value="18">Fanfare (Call4)</option>
					<option value="19">Gun Shot (Call5)</option>
					<option value="20">Honk (Call6)</option>
					<option value="21">Jaw Harp (Call7)</option>
					<option value="22">Morse (Call8)</option>
					<option value="23">Electricity (Call9)</option>
					<option value="24">Radio Tuner (Call10)</option>
					<option value="25">Sirens</option>
					<option value="26">Military Trumpets</option>
					<option value="27">Ufo</option>
					<option value="28">Whah Whah Whah</option>
            </select></td>
            <td></td>
        </tr>
    </table>
    <button id="test" class="translate">Test</button>
</div>
</html>
